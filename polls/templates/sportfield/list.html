{% extends 'index.html' %} {% block content %}
<h1 class="text-2xl font-bold mb-4">Daftar Lapangan</h1>

<table class="min-w-full bg-white border table-auto">
  <thead>
    <tr class="bg-gray-800 text-white">
      <th class="text-start px-6 py-3">Nama Lapangan</th>
      <th class="py-3">Tipe Olahraga</th>
      <th class="py-3">Aksi</th>
    </tr>
  </thead>
  <tbody id="fieldTable" class="divide-y">
    <!-- Data akan diisi menggunakan jQuery -->
  </tbody>
</table>
<div class=" mt-4">
  <button
    class="px-4 py-2 bg-blue-600 text-white rounded mb-4"
    onclick="showAddModal()"
  >
    Tambah Lapangan
  </button>
</div>

<!-- Modal Tambah Lapangan -->
<div
  id="addFieldModal"
  class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center"
>
  <div class="bg-white p-6 rounded shadow-md w-1/2">
    <h2 class="text-xl font-bold mb-4">Tambah Lapangan Baru</h2>
    <form id="addFieldForm" class="space-y-4">
      <div>
        <label for="name" class="block text-sm font-medium"
          >Nama Lapangan</label
        >
        <input
          type="text"
          id="name"
          placeholder="Nama Lapangan"
          class="p-2 border rounded w-full"
          required
        />
      </div>
      <div>
        <label for="location" class="block text-sm font-medium">Lokasi</label>
        <input
          type="text"
          id="location"
          placeholder="Lokasi"
          class="p-2 border rounded w-full"
          required
        />
      </div>
      <div>
        <label for="sport_type" class="block text-sm font-medium"
          >Jenis Olahraga</label
        >
        <input
          type="text"
          id="sport_type"
          placeholder="Jenis Olahraga"
          class="p-2 border rounded w-full"
          required
        />
      </div>
      <div>
        <label for="price_per_hour" class="block text-sm font-medium"
          >Harga per Jam</label
        >
        <input
          type="number"
          id="price_per_hour"
          placeholder="Harga per Jam"
          class="p-2 border rounded w-full"
          required
        />
      </div>
      <div>
        <label for="operating_hours" class="block text-sm font-medium"
          >Jam Operasional</label
        >
        <input
          type="text"
          id="operating_hours"
          placeholder="Jam Operasional"
          class="p-2 border rounded w-full"
          required
        />
      </div>
      <div>
        <label class="block text-sm font-medium">
          <input type="checkbox" id="is_available" class="mr-2" /> Tersedia
        </label>
      </div>
      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="hideAddModal()"
          class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
        >
          Batal
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
          
        >
          Tambah Lapangan
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Form Edit (Disembunyikan secara default) -->
<form
  method="POST"
  id="editFieldForm"
  class="bg-white p-6 rounded shadow mt-6 hidden"
>
  {% csrf_token %}
  <h2 class="text-xl font-bold mb-4">Edit Lapangan</h2>
  <div class="mb-4">
    <label for="editName" class="block text-sm font-medium"
      >Nama Lapangan</label
    >
    <input
      id="editName"
      name="name"
      type="text"
      value="{{ field.name }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editLocation" class="block text-sm font-medium">Lokasi</label>
    <input
      id="editLocation"
      name="location"
      type="text"
      value="{{ field.location }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editSportType" class="block text-sm font-medium"
      >Jenis Olahraga</label
    >
    <input
      id="editSportType"
      name="sport_type"
      type="text"
      value="{{ field.sport_type }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editPricePerHour" class="block text-sm font-medium"
      >Harga per Jam</label
    >
    <input
      id="editPricePerHour"
      name="price_per_hour"
      type="number"
      step="0.01"
      value="{{ field.fielddetail.price_per_hour }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editJamOperasional" class="block text-sm font-medium"
      >Jam Operasional</label
    >
    <input
      id="editJamoperasional"
      name="Jam Operasional"
      type="text"
      value="{{ field.fielddetail.operating_hours }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editIsAvailable" class="block text-sm font-medium"
      >Ketersediaan</label
    >
    <input id="editIsAvailable" name="is_available" type="checkbox" {{
    field.fielddetail.is_available|yesno:"checked," }} class="h-5 w-5">
  </div>

  <!-- Tombol Simpan -->
  <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">
    Simpan Perubahan
  </button>
</form>

<script>
  // Ambil CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Menampilkan modal
  function showAddModal() {
    document.getElementById("addFieldModal").classList.remove("hidden");
  }

  // Menyembunyikan modal
  function hideAddModal() {
    document.getElementById("addFieldModal").classList.add("hidden");
  }

  // // Tampilkan form edit ketika tombol Edit diklik
  // document.getElementById("editButton").onclick = function () {
  //   document.getElementById("editFieldForm").classList.remove("hidden");
  // };

  // Load data lapangan
  function loadFields() {
    $.getJSON("/fields/", function (data) {
      let rows = "";
      data.forEach((field) => {
        rows += `
                      <tr>
                          <td class=" text-start px-6 py-4"><a href="/fields/${field.id}/" class="text-blue-500">${field.name}</a></td>
                          <td class="text-center px-6 py-4">${field.sport_type}</td>
                          <td class="text-center px-6 py-4">
                              <button id="editButton" class="bg-yellow-500 px-4 py-2 rounded" onclick="editField(${field.id})">Edit</button>
                              <button  id="deleteButton" class="bg-red-500 px-4 py-2 rounded " onclick="deleteField(${field.id})">Hapus</button>
                          </td>
                      </tr>
                  `;
      });
      $("#fieldTable").html(rows);
    });
  }

  $(document).ready(function () {
    loadFields();
  });

  // Menambah lapangan menggunakan AJAX
  $("#addFieldForm").on("submit", function (e) {
    e.preventDefault();

    const data = {
      name: $("#name").val(),
      location: $("#location").val(),
      sport_type: $("#sport_type").val(),
      price_per_hour: $("#price_per_hour").val(),
      operating_hours: $("#operating_hours").val(),
      is_available: $("#is_available").is(":checked"),
    };

    $.ajax({
      url: "/fields/add/",
      type: "POST",
      data: data,
      headers: {
        "X-CSRFToken": getCookie("csrftoken"), // Menyertakan CSRF token di header
      },
      success: function (response) {
        alert(response.message);
        loadFields(); // reload data setelah berhasil tambah
        hideAddModal();
      },
      error: function (xhr, status, error) {
        alert("Terjadi kesalahan, silakan coba lagi.");
      },
    });
  });

  //   // Kirim data update ke server menggunakan API
  //   document.getElementById("editFieldForm").onsubmit = function (e) {
  //     e.preventDefault(); // Cegah refresh halaman
  //     const fieldId = "{{ field.id }}"; // ID lapangan dari context
  //     const formData = new FormData(this); // Ambil data dari form

  //     // Kirim permintaan update ke server
  //     fetch(`/fields/update/${fieldId}/`, {
  //       method: "POST",
  //       body: formData,
  //       headers: {
  //         "X-CSRFToken": document.querySelector('[name="csrfmiddlewaretoken"]')
  //           .value,
  //       },
  //     })
  //       .then((response) => response.json())
  //       .then((data) => {
  //         alert(data.message); // Tampilkan pesan sukses/gagal
  //         if (data.message === "Lapangan berhasil diperbarui!") {
  //           location.reload(); // Refresh halaman jika berhasil
  //         }
  //       })
  //       .catch((error) => {
  //         console.error("Error:", error);
  //         alert("Terjadi kesalahan saat memperbarui lapangan.");
  //       });
  //   };

  //   //   // Contoh AJAX untuk edit lapangan
  //   //   function editField(fieldId) {
  //   //     const data = {
  //   //       name: document.getElementById("fieldName").value,
  //   //       location: document.getElementById("fieldLocation").value,
  //   //       operating_hours: document.getElementById("fieldOperatingHours").value,
  //   //       price_per_hour: document.getElementById("fieldPrice").value,
  //   //       is_available: document.getElementById("fieldAvailable").checked
  //   //         ? "true"
  //   //         : "false",
  //   //     };

  //   //     fetch(`/fields/update/${fieldId}/`, {
  //   //       method: "POST",
  //   //       headers: {
  //   //         "Content-Type": "application/json",
  //   //         "X-CSRFToken": getCSRFToken(),
  //   //       },
  //   //       body: JSON.stringify(data),
  //   //     })
  //   //       .then((response) => response.json())
  //   //       .then((data) => alert(data.message))
  //   //       .catch((error) => console.error("Error:", error));
  //   //   }

  //   // Kirim permintaan hapus data ke server
  //   document.getElementById("deleteButton").onclick = function () {
  //     const fieldId = "{{ field.id }}";
  //     if (confirm("Apakah Anda yakin ingin menghapus lapangan ini?")) {
  //       fetch(`/sportfield/fields/delete/${fieldId}/`, {
  //         method: "POST",
  //         headers: {
  //           "X-CSRFToken": document.querySelector('[name="csrfmiddlewaretoken"]')
  //             .value,
  //         },
  //       })
  //         .then((response) => response.json())
  //         .then((data) => {
  //           alert(data.message);
  //           if (data.message === "Lapangan berhasil dihapus!") {
  //             window.location.href = "/sportfield/list/"; // Redirect ke daftar lapangan
  //           }
  //         })
  //         .catch((error) => {
  //           console.error("Error:", error);
  //           alert("Terjadi kesalahan saat menghapus lapangan.");
  //         });
  //     }
  //   };

  //   // Hapus lapangan
  //   //   function deleteField(field_id) {
  //   //     if (confirm("Apakah Anda yakin ingin menghapus lapangan ini?")) {
  //   //       $.ajax({
  //   //         url: `/fields/delete/${field_id}/`,
  //   //         type: "POST",
  //   //         headers: {
  //   //           "X-CSRFToken": getCookie("csrftoken"),
  //   //         },
  //   //         success: function (response) {
  //   //           alert(response.message);
  //   //           loadFields();
  //   //         },
  //   //         error: function () {
  //   //           alert("Terjadi kesalahan saat menghapus lapangan.");
  //   //         },
  //   //       });
  //   //     }
  //   //   }
  //   }
</script>
{% endblock %} // document // .getElementById("saveFieldBtn") //
.addEventListener("click", function () { // const name =
document.getElementById("fieldName").value; // const location =
document.getElementById("fieldLocation").value; // const operatingHours =
document.getElementById( // "fieldOperatingHours" // ).value; // const
pricePerHour = document.getElementById("fieldPrice").value; // const isAvailable
= document.getElementById("fieldAvailability").checked // ? "true" // : "false";
// const csrfToken = getCSRFToken(); // Pastikan Anda memiliki fungsi untuk
mengambil CSRF token // fetch("/fields/add/", { // method: "POST", // headers: {
// "Content-Type": "application/json", // "X-CSRFToken": csrfToken, // }, //
body: JSON.stringify({ // name: name, // location: location, // operating_hours:
operatingHours, // price_per_hour: pricePerHour, // is_available: isAvailable,
// }), // }) // .then((response) => response.json()) // .then((data) => { //
alert(data.message); // Menampilkan pesan sukses // if
(data.message.includes("berhasil")) { // location.reload(); // Reload halaman
jika berhasil // } // }) // .catch((error) => { // console.error("Error:",
error); // alert("Terjadi kesalahan. Coba lagi."); // }); // });
