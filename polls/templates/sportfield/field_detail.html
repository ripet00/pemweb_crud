<!-- templates/sportfield/field_detail.html -->
{% extends 'index.html' %} {% block content %}

<a href="/sportfield/list/" class="py-8 text-black text-2xl font-bold">
  ‚Üê Kembali ke Daftar Lapangan
</a>

<h1 class="text-2xl font-bold mb-4 mt-16">Detail Lapangan</h1>

<!-- Tampilkan Detail Lapangan -->
<div class="bg-gray-100 p-6 rounded shadow mb-6">
  <p><strong>Nama Lapangan:</strong> {{ field.name }}</p>
  <p><strong>Lokasi:</strong> {{ field.location }}</p>
  <p><strong>Jenis Olahraga:</strong> {{ field.sport_type }}</p>
  <p>
    <strong>Harga per Jam:</strong> Rp {{ field.fielddetail.price_per_hour }}
  </p>
  <p><strong>Fasilitas:</strong> {{ field.fielddetail.facilities }}</p>
  <p>
    <strong>Ketersediaan:</strong>
    {% if field.fielddetail.is_available %} Tersedia {% else %} Tidak Tersedia
    {% endif %}
  </p>
</div>

<!-- Tombol untuk Edit dan Hapus -->
<div class="flex gap-4">
  <!-- Button Edit -->
  <button id="editButton" class="bg-yellow-600 text-white px-4 py-2 rounded">
    Edit Data
  </button>

  <!-- Button Hapus -->
  <button id="deleteButton" class="bg-red-600 text-white px-4 py-2 rounded">
    Hapus Data
  </button>
</div>

<!-- Form Edit (Disembunyikan secara default) -->
<form
  method="POST"
  id="editFieldForm"
  class="bg-white p-6 rounded shadow mt-6 hidden"
>
  {% csrf_token %}
  <h2 class="text-xl font-bold mb-4">Edit Lapangan</h2>
  <div class="mb-4">
    <label for="editName" class="block text-sm font-medium"
      >Nama Lapangan</label
    >
    <input
      id="editName"
      name="name"
      type="text"
      value="{{ field.name }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editLocation" class="block text-sm font-medium">Lokasi</label>
    <input
      id="editLocation"
      name="location"
      type="text"
      value="{{ field.location }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editSportType" class="block text-sm font-medium"
      >Jenis Olahraga</label
    >
    <input
      id="editSportType"
      name="sport_type"
      type="text"
      value="{{ field.sport_type }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editPricePerHour" class="block text-sm font-medium"
      >Harga per Jam</label
    >
    <input
      id="editPricePerHour"
      name="price_per_hour"
      type="number"
      step="0.01"
      value="{{ field.fielddetail.price_per_hour }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editFacilities" class="block text-sm font-medium"
      >Fasilitas</label
    >
    <input
      id="editFacilities"
      name="facilities"
      type="text"
      value="{{ field.fielddetail.facilities }}"
      required
      class="border rounded px-4 py-2 w-full"
    />
  </div>

  <div class="mb-4">
    <label for="editIsAvailable" class="block text-sm font-medium"
      >Ketersediaan</label
    >
    <input id="editIsAvailable" name="is_available" type="checkbox" {{
    field.fielddetail.is_available|yesno:"checked," }} class="h-5 w-5">
  </div>

  <!-- Tombol Simpan -->
  <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">
    Simpan Perubahan
  </button>
</form>

<script>
  // Tampilkan form edit ketika tombol Edit diklik
  document.getElementById("editButton").onclick = function () {
    document.getElementById("editFieldForm").classList.remove("hidden");
  };

  // Kirim data update ke server menggunakan API
  document.getElementById("editFieldForm").onsubmit = function (e) {
    e.preventDefault(); // Cegah refresh halaman
    const fieldId = "{{ field.id }}"; // ID lapangan dari context
    const formData = new FormData(this); // Ambil data dari form

    // Kirim permintaan update ke server
    fetch(`/sportfield/fields/update/${fieldId}/`, {
      method: "POST",
      body: formData,
      headers: {
        "X-CSRFToken": document.querySelector('[name="csrfmiddlewaretoken"]')
          .value,
      },
    })
      .then((response) => response.json())
      .then((data) => {
        alert(data.message); // Tampilkan pesan sukses/gagal
        if (data.message === "Lapangan berhasil diperbarui!") {
          location.reload(); // Refresh halaman jika berhasil
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Terjadi kesalahan saat memperbarui lapangan.");
      });
  };

  // Kirim permintaan hapus data ke server
  document.getElementById("deleteButton").onclick = function () {
    const fieldId = "{{ field.id }}";
    if (confirm("Apakah Anda yakin ingin menghapus lapangan ini?")) {
      fetch(`/sportfield/fields/delete/${fieldId}/`, {
        method: "POST",
        headers: {
          "X-CSRFToken": document.querySelector('[name="csrfmiddlewaretoken"]')
            .value,
        },
      })
        .then((response) => response.json())
        .then((data) => {
          alert(data.message);
          if (data.message === "Lapangan berhasil dihapus!") {
            window.location.href = "/sportfield/list/"; // Redirect ke daftar lapangan
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("Terjadi kesalahan saat menghapus lapangan.");
        });
    }
  };
</script>

{% endblock %}
<!-- <td class="px-6 py-4">
    <button class="text-red-500" onclick="deleteField(${field.id})">Hapus</button>
</td> -->
