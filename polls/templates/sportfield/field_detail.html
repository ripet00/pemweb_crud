{% extends 'index.html' %} {% block content %}
<a href="/" class="text-xl font-bold"> Â« kembali </a>
<h1 class="text-2xl font-bold mb-4 mt-8">Detail Lapangan: {{ field.name }}</h1>

<div class="mb-6">
  <h2 class="text-lg font-bold">Informasi Lapangan</h2>
  <p><strong>Lokasi:</strong> {{ field.location }}</p>
  <p><strong>Tipe Olahraga:</strong> {{ field.sport_type }}</p>
  <p><strong>Harga per Jam:</strong> Rp {{ field.price_per_hour }}</p>
  <p>
    <strong>Ketersediaan:</strong>
    {% if field.is_available %} Tersedia {% else %} Tidak Tersedia {% endif %}
  </p>
</div>

<div class="mb-6">
  <h2 class="text-lg font-bold">Daftar Fasilitas</h2>
  <table class="min-w-full bg-white border table-auto">
    <thead>
      <tr class="bg-gray-800 text-white">
        <th class="text-start px-6 py-3">Nama Fasilitas</th>
        <th class="py-3">Aksi</th>
      </tr>
    </thead>
    <tbody id="fieldTable" class="divide-y">
      {% for facility in facilities %}
      <tr>
        <td class="text-start px-6 py-4">{{ facility.name }}</td>
        <td class="text-center px-6 py-4">
          <button
            id="editButton"
            class="bg-yellow-500 px-4 py-2 rounded"
            onclick="editFacility('{{ facility.id }}')"
          >
            Edit
          </button>
          <button
            id="deleteButton"
            class="bg-red-500 px-4 py-2 rounded"
            onclick="deleteFacility('{{ facility.id }}')"
          >
            Hapus
          </button>
        </td>
      </tr>
      {% endfor %} {% if facilities|length == 0 %}
      <tr>
        <td colspan="2" class="text-center py-4">
          Tidak ada fasilitas tersedia.
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<button
  class="px-4 py-2 bg-blue-600 text-white rounded mb-4"
  onclick="showAddFacilityModal()"
>
  Tambah Fasilitas
</button>

<!-- Modal Tambah Fasilitas -->
<div
  id="addFacilityModal"
  class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center"
>
  <div class="bg-white p-6 rounded">
    <h2 class="text-lg font-bold mb-4">Tambah Fasilitas</h2>
    <form id="addFacilityForm" class="space-y-4">
      <input
        type="text"
        id="facilityName"
        placeholder="Nama Fasilitas"
        class="p-2 border rounded w-full"
      />
      <textarea
        id="facilityDescription"
        placeholder="Deskripsi"
        class="p-2 border rounded w-full"
      ></textarea>
      <label class="block">
        <input type="checkbox" id="facilityAvailability" /> Tersedia
      </label>
      <div class="flex justify-between">
        <button
          type="button"
          class="px-4 py-2 bg-gray-600 text-white rounded"
          onclick="closeAddFacilityModal()"
        >
          Batal
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">
          Tambah
        </button>
      </div>
    </form>
  </div>
</div>

<!-- <table>
  <thead>
    <tr>
      <th>Nama Fasilitas</th>
      <th>Deskripsi</th>
      <th>Ketersediaan</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody>
    {% for facility in facilities %}
    <tr>
      <td>
        <input
          type="text"
          id="facilityName-{{ facility.id }}"
          value="{{ facility.name }}"
        />
      </td>
      <td>
        <textarea id="facilityDescription-{{ facility.id }}">
{{ facility.description }}</textarea
        >
      </td>
      <td>
        <input
          type="checkbox"
          id="facilityAvailable-{{ facility.id }}"
          {%
          if
          facility.is_available
          %}checked{%
          endif
          %}
        />
      </td>
      <td>
        <button onclick="editFacility('{{ facility.id }}')">Simpan</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table> -->

<script>
  // Fungsi untuk mendapatkan CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // Tampilkan modal tambah fasilitas
  function showAddFacilityModal() {
    document.getElementById("addFacilityModal").classList.remove("hidden");
  }

  // Tutup modal tambah fasilitas
  function closeAddFacilityModal() {
    document.getElementById("addFacilityModal").classList.add("hidden");
  }

  function loadFields() {
    $.getJSON("/fields/", function (data) {
      let rows = "";
      data.forEach((field) => {
        rows += `
                      <tr>
                          <td class=" text-start px-6 py-4"><a href="/fields/${field.id}/" class="text-blue-500">${field.name}</a></td>
                          <td class="text-center px-6 py-4">${field.sport_type}</td>
                          <td class="text-center px-6 py-4">
                              <button id="editButton" class="bg-yellow-500 px-4 py-2 rounded" onclick="editField(${field.id})">Edit</button>
                              <button  id="deleteButton" class="bg-red-500 px-4 py-2 rounded " onclick="deleteField(${field.id})">Hapus</button>
                          </td>
                      </tr>
                  `;
      });
      $("#fieldTable").html(rows);
    });
  }

  // Tambah fasilitas menggunakan AJAX
  $("#addFacilityForm").on("submit", function (e) {
    e.preventDefault();

    const data = {
      name: $("#facilityName").val(),
      description: $("#facilityDescription").val(),
      is_available: $("#facilityAvailability").is(":checked"),
    };

    $.ajax({
      url: `/fields/{{ field.id }}/facilities/add/`,
      type: "POST",
      data: data,
      headers: {
        "X-CSRFToken": getCookie("csrftoken"),
      },
      success: function (response) {
        alert(response.message);
        location.reload();
      },
      error: function () {
        alert("Terjadi kesalahan, silakan coba lagi.");
      },
    });
  });

  // // Contoh AJAX untuk edit fasilitas
  // function editFacility(facilityId) {
  //   const data = {
  //     name: document.getElementById(`facilityName-${facilityId}`).value, // Ambil data nama fasilitas
  //     description: document.getElementById(`facilityDescription-${facilityId}`)
  //       .value, // Ambil deskripsi fasilitas
  //     is_available: document.getElementById(`facilityAvailable-${facilityId}`)
  //       .checked
  //       ? "true"
  //       : "false", // Status ketersediaan
  //   };

  //   fetch(`/facilities/update/${facilityId}/`, {
  //     method: "POST",
  //     headers: {
  //       "Content-Type": "application/json",
  //       "X-CSRFToken": getCSRFToken(),
  //     }, // Sertakan CSRF token
  //     body: JSON.stringify(data), // Kirimkan data sebagai JSON
  //   })
  //     .then((response) => response.json())
  //     .then((data) => {
  //       alert(data.message); // Tampilkan pesan sukses atau error
  //       if (data.message.includes("berhasil")) {
  //         location.reload(); // Reload halaman jika berhasil
  //       }
  //     })
  //     .catch((error) => console.error("Error:", error)); // Tangani error jika ada
  // }

  // // Hapus fasilitas
  // function deleteFacility(facility_id) {
  //   if (confirm("Apakah Anda yakin ingin menghapus fasilitas ini?")) {
  //     $.ajax({
  //       url: `/facilities/delete/${facility_id}/`,
  //       type: "POST",
  //       headers: {
  //         "X-CSRFToken": getCookie("csrftoken"),
  //       },
  //       success: function (response) {
  //         alert(response.message);
  //         location.reload();
  //       },
  //       error: function () {
  //         alert("Terjadi kesalahan, silakan coba lagi.");
  //       },
  //     });
  //   }
  // }
</script>
{% endblock %}
